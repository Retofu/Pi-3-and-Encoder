# RS-485 Transmitter для Raspberry Pi 3

Этот скрипт предназначен для циклической передачи данных энкодера через интерфейс RS-485.

## Описание

Скрипт `rs.py` формирует и передает пакеты данных размером 116 байт через RS-485 с интервалом 3 мс. В пакете:
- Байты 1-55 и 60-116: заполнены нулями
- Байты 56-59: угол в радианах (float32, little-endian)

## Настройка

### 1. Настройка pigpio daemon
```bash
sudo systemctl enable pigpiod
sudo systemctl start pigpiod
```

### 2. Настройка RS-485 устройства
Скрипт автоматически найдет доступные последовательные порты. Если RS-485 устройство не подключено, скрипт перейдет в режим симуляции.

**Доступные типы портов:**
- `/dev/ttyUSB*` - USB-адаптеры RS-485
- `/dev/ttyACM*` - USB CDC устройства
- `/dev/ttyS*` - встроенные последовательные порты

**Если устройство не найдено:**
Скрипт автоматически перейдет в режим симуляции и будет выводить данные только в консоль.

### 3. Настройка пинов энкодера
По умолчанию используются пины:
- GPIO17 (pin 11) - Фаза A
- GPIO22 (pin 12) - Фаза B  
- GPIO27 (pin 13) - Фаза Z

## Запуск

```bash
python rs.py
```

## Структура пакета данных

```
Байт 1-55:    [0x00, 0x00, ..., 0x00]  (55 байт)
Байт 56-59:   [угол в радианах как float32, little-endian]
Байт 60-116:  [0x00, 0x00, ..., 0x00]  (57 байт)
```

## Параметры

- **Интервал передачи**: 3 мс
- **Размер пакета**: 116 байт
- **Скорость RS-485**: 9600 bps (по умолчанию)
- **PPR энкодера**: 1200 импульсов на оборот

## Остановка

Нажмите `Ctrl+C` для корректной остановки скрипта.

## Логирование

Скрипт выводит в консоль:
- Статус инициализации компонентов
- Список доступных последовательных портов
- Информацию о переданных пакетах (каждые 100 пакетов)
- Текущий угол в радианах и счетчик импульсов
- Hex-представление байтов 56-59 (угол)

## Решение проблем

### Ошибка "No such file or directory: '/dev/ttyUSB0'"
**Решение:** Скрипт теперь автоматически ищет доступные порты. Если RS-485 устройство не подключено, скрипт перейдет в режим симуляции.

### Проверка доступных портов
```bash
ls /dev/tty*
```

### Установка зависимостей
```bash
pip install pigpio pyserial
```

### Проверка работы pigpio
```bash
sudo systemctl status pigpiod
```
